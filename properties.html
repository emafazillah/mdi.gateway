<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, shrink-to-fit=no, initial-scale=1">
        <meta name="description" content="administration panel to monitor and manage list of medical devices">
        <meta name="author" content="irwan ibrahim, psg device intergration team">

        <title>CD | Device Integration Gateway</title>

        <!-- Bootstrap Core CSS -->
        <link href="./assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="./assets/bootstrap/css/bootstrap-theme.min.css" />

        <!-- Custom CSS -->
        <link href="./assets/customs/css/sidebar.css" rel="stylesheet">
        <link href="./assets/customs/css/cd-design.css" rel="stylesheet">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>

    <body>

        <div id="wrapper">

            <!-- Sidebar -->
            <div id="sidebar-wrapper">
                <ul class="sidebar-nav">
                    <li class="sidebar-brand"><a href="./">Device Menu</a></li>
                    <li><a href="./">Dashboard</a></li>
                    <li><a href="./?dc=patient-monitoring">Patient Monitoring</a></li>
                    <li><a href="./?dc=ultrasound">Ultra Sound</a></li>
                    <li><a href="./?dc=planmeca">PlanMeca X Ray</a></li>
                    <li><a href="./?dc=analyzer">Analyzer</a></li>
                    <li><a href="./?dc=fundus-camera">Fundus Camera</a></li>
                    <li><a href="./?dc=endoscopy">Endoscopy Processor</a></li>
                    <li><a href="./?dc=auditmeter">AudioMeter</a></li>
                    <li><a href="./?dc=fbcmachine">FBC Machine</a></li>
                    <li><a href="./?dc=spirometer">Spiro Meter</a></li>
                    <hr>
                    <li><a href='https://mdi-sample-fetch.herokuapp.com/' target='_blank'>HIS Form Sample</a></li>
                </ul>
            </div>
            <!-- /#sidebar-wrapper -->

            <!-- Page Content -->
            <div id="page-content-wrapper">
                <div class="container-fluid">
                    <ol class="breadcrumb">
                        <li><a href="./"><i class="glyphicon glyphicon-home"></i></a></li>
                        <li><a href="./?dc=patient-monitoring" id='deviceType' class='first-letter'>&lt; device type &gt;</a></li>
                        <li class="active" id='deviceName'><i>&lt;device name&gt;</i></li>
                    </ol>

                    <div class="row">
                        <div class="col-sm-3 hidden">
                            <div class="row statinfo">
                                <div class="col-sm-12">
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <h1>Online Duration</h1>
                                            <div class="text-center">
                                                <h2><i>&lt;hours&gt;</i> hours</h2>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <h1>No Of Request</h1>
                                            <div class="text-center">
                                                <h2><i>&lt;stdin&gt;</i> /min</h2>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <h1>Error Count</h1>
                                            <div class="text-center">
                                                <h2><i>&lt;error&gt;</i> </h2>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <h1>Error Rate</h1>
                                            <div class="text-center">
                                                <h2><i>&lt;error rate&gt;</i> %</h2>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-12">
                            <ul class="nav nav-tabs nav-justified" role="tablist">
                                <li role="presentation" class="active"><a href="#properties" aria-controls="properties" role="tab" data-toggle="tab">Properties</a></li>
                                <li role="presentation"><a href="#apireference" aria-controls="apireference" role="tab" data-toggle="tab">API Reference</a></li>
                                <li role="presentation"><a href="#logs" aria-controls="logs" role="tab" data-toggle="tab">Logs</a></li>
                            </ul>

                            <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="properties">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="panel panel-default">
                                                <div class="panel-heading"><h4>Device Properties</h4></div>
                                                <table class="table ">
                                                    <tr>
                                                        <th style="width: 18%">Device ID</th>
                                                        <td style="width: 2%">:</td>
                                                        <td style="width: 30%" id='deviceId'></td>
                                                        <th style="width: 18%">Device Serial</th>
                                                        <td style="width: 2%">:</td>
                                                        <td style="width: 30%" id='deviceSerial'><i>&lt;device category&gt;</i></td>
                                                    </tr>
                                                    <tr>
                                                        <th>Brand</th>
                                                        <td>:</td>
                                                        <td id='deviceBrand'><i>&lt;brand&gt;</i></td>
                                                        <th>Model</th>
                                                        <td>:</td>
                                                        <td id='deviceModel'><i>&lt;model&gt;</i></td>
                                                    </tr>
                                                    <tr>
                                                        <th style="width: 18%;">Location</th>
                                                        <td style="width: 2%;">:</td>
                                                        <td colspan="4" id='deviceLocation'><i>&lt;location&gt;</i></td>
                                                    </tr>
                                                    <tr>
                                                        <th>Status</th>
                                                        <td>:</td>
                                                        <td id='deviceStatus'><i>&lt;status&gt;</i></td>
                                                        <th>Connection Type</th>
                                                        <td>:</td>
                                                        <td id='deviceConnectionType'></td>
                                                    </tr>
                                                    <tr>
                                                        <th>Transmission Protocol</th>
                                                        <td>:</td>
                                                        <td id='deviceProtocol'><i>&lt;transmission protocol&gt;</i></td>
                                                        <th>URI</th>
                                                        <td>:</td>
                                                        <td id='resturi'></td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="apireference">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">API TEST</div>
                                        <div class="panel-body">
                                            
                                            <form id='apiTestCall' class="form-horizontal">
                                                <input type='hidden' id='restfulhttp' />
                                                <div class="col-sm-2">
                                                    <div class='form-group form-group-sm'>
                                                        <select id='ApiMethod' class="form-control input-sm">
                                                            <option value="get">GET</option>
                                                            <option value="put">PUT</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class='col-sm-4'>
                                                    <div class='form-group form-group-sm'>
                                                        <select id='ApiSelect' class='form-control'>
                                                            <option value='patient-examinations'>Patient Examination</option>
                                                            <option value='spiro-forced-tests'>Spiro Forced Tests</option>
                                                            <option value='exam-graph'>Exam Graphs</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <div class="input-group input-group-sm">
                                                            <input type="text" id='ApiParameter' class="form-control input-sm" autocomplete="off" value='810204085611'/>
                                                            <span class="input-group-btn">
                                                                <button type="submit" class="btn btn-primary" >FETCH RESULT</button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class='panel-heading panel-second-heading'>Fetch Result</div>
                                        <div class='panel-body' style='background-color: #fcfcfc'>
                                            <div class='row'>
                                                <div class='col-sm-12'>
                                                    <div class='input-group input-group-sm'>
                                                        <span class='input-group-addon'>REST URL</span>
                                                        <input type='text' id='resturl' class='form-control disabled' readonly/>
                                                        <div class='input-group-btn'>
                                                            <button type='button' class='btn btn-primary' ><i class='glyphicon glyphicon-copy'></i> Copy URL</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class='row'>
                                                <div class='col-sm-12'>
                                                    <div id='apiFetchResult' class="jsonView"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="logs">
                                    <div class="row">

                                        <div class="col-sm-12">
                                            <table class="table table-condensed">
                                                <thead>
                                                    <tr>
                                                        <th>No</th>
                                                        <th>Log</th>
                                                        <th>Date Time</th>
                                                        <th>Flag</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="4"><i>No transaction so far...</i></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /#page-content-wrapper -->

        </div>
        <!-- /#wrapper -->

        <!-- jQuery -->
        <script src="./assets/jquery/jquery-3.1.1.min.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="./assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="./assets/main.js"></script>

        <!-- Menu Toggle Script -->
        <script>
            $("#menu-toggle").click(function (e) {
                e.preventDefault();
                $("#wrapper").toggleClass("toggled");
            });

            function DeviceDetail(detail) {
//                console.log(detail);
                return detail;
            }

            function GetDeviceInfo() {
                $.getJSON("data/device_list.json", function (json, cb) {
                    var deviceCategory = getParameterByName('dc');
                    var deviceId = getParameterByName('id');
                    var deviceInfo;
                    var path;
                    var urlpath;
                    for (var i in json) {
                        if (i == deviceCategory) {
                            for (var j in json[i]) {
                                if (json[i][j].device_id == deviceId) {
                                    deviceInfo = json[i][j];
                                    $('#deviceType').attr('href','./?dc='+deviceCategory);
                                    $('#deviceType').text(deviceCategory);
                                    $('#deviceName').text(deviceInfo.brand + ' ' + deviceInfo.model);
                                    $('#deviceSerial').text(deviceInfo.serial_number);
                                    $('#deviceId').text(deviceInfo.device_id);
                                    $('#deviceProtocol').text(deviceInfo.transmission_protocol);
                                    $('#deviceModel').text(deviceInfo.model);
                                    $('#deviceBrand').text(deviceInfo.brand);
                                    $('#deviceLocation').text(deviceInfo.location.location_code+ ' '+ deviceInfo.location.location_name);
                                    $('#deviceConnectionType').text(deviceInfo.location.connection);
                                    $('#resturi').html(deviceInfo.restserver.host);
                                    $('#deviceStatus').text(deviceInfo.status);
                                    
                                    path = json[i][j].restserver;
                                    $.each(path.path, function(i,v){
                                        urlpath += "<option value='"+v.path+"'>"+v.name+"</option>";
                                    });
                                    $('#restfulhttp').val(path.host);
                                    $('#ApiSelect').html(urlpath);
                                }
                            }
                        }
                    }
                });
            }

            $(function () {

                GetDeviceInfo()

                $('#apiTestCall').submit(function (e) {
                    var method = $('#ApiMethod').val();
                    var selection = $('#ApiSelect').val()
                    var parameter = $('#ApiParameter').val();
                    var url = $('#restfulhttp').val();

                    e.preventDefault();
                    $.ajax({
                        crossOrigin: true,
                        url: url + selection + '/' + parameter,
                        type: method,
                        dataType: "json",
                        success: function (data) {
                            $('#resturl').val(url + selection + '/' + parameter);
                            var str = JSON.stringify(data, null, 12)
                            $('#apiFetchResult').html(str);
                        }
                    });
                });
            });

        </script>
    </body>
</html>
